# 온라인 시험 부정행위 탐지 시스템

이 프로젝트는 웹캠을 활용하여 온라인 시험 중 부정행위를 감지하는 토이 프로젝트입니다. 시선 추적, 객체 탐지, 머리 방향 추정, 화면 관심 영역(ROI) 모니터링을 통해 응시자의 부정행위를 실시간으로 탐지합니다. 초보자도 접근 가능한 간단한 구현을 목표로 하며, OpenCV, GazeTracking, YOLOv8, Dlib를 사용하여 Python으로 개발되었습니다.

## 프로젝트 개요

이 시스템은 온라인 시험 환경에서 응시자의 부정행위를 감지하기 위해 설계되었습니다. 주요 기능은 다음과 같습니다:
- **시선 추적**: GazeTracking 라이브러리를 사용해 응시자의 시선이 화면 중앙에서 5초 이상 벗어나는지 확인합니다.
- **객체 탐지**: YOLOv8을 활용해 휴대폰, 책 등 부정행위와 관련된 객체를 탐지합니다.
- **머리 방향 추정**: Dlib를 사용해 얼굴 랜드마크를 기반으로 머리 방향(요, 피치, 롤)을 추정하여 응시자가 화면을 향하고 있는지 확인합니다.
- **화면 영역 정의**: 화면을 중앙과 주변 영역으로 나누어 시선과 머리 방향이 정의된 ROI 내에 있는지 판단합니다.

## 상세 요구사항

### 입력
- **웹캠 영상**: 실시간 비디오 스트림 (30fps, 최소 640x480 해상도).
- **환경**: 적절한 조명과 웹캠 품질이 필요.

### 출력
- **부정행위 경고**: 시선, 객체, 머리 방향, ROI 기준으로 부정행위가 감지되면 콘솔 메시지와 화면에 경고 표시.
- **로그 (선택적)**: 타임스탬프와 함께 부정행위 이벤트를 기록.

### 기술 스택
- **OpenCV**: 비디오 캡처 및 프레임 처리 ([OpenCV](https://opencv.org/)).
- **GazeTracking**: 시선 방향 추적 및 깜빡임 감지 ([GazeTracking](https://github.com/antoinelame/GazeTracking)).
- **YOLOv8**: 부정행위 관련 객체 탐지 ([Ultralytics YOLO](https://docs.ultralytics.com/)).
- **Dlib**: 얼굴 랜드마크 탐지 및 머리 방향 추정 ([Dlib](http://dlib.net/)).
- **Python**: 구현 언어.

### 세부 요구사항
- **비디오 캡처**: OpenCV로 실시간 영상 획득.
- **시선 추적**: 시선이 중앙에서 5초 (150프레임, 30fps 기준) 이상 벗어나면 부정행위로 간주.
- **객체 탐지**: YOLOv8으로 휴대폰, 책 등 탐지 (신뢰도 0.5 이상).
- **머리 방향 추정**: Dlib로 얼굴 랜드마크 탐지, 요 각도가 ±30도 이상 벗어나면 부정행위로 간주.
- **화면 영역 정의**: 중앙 ROI (640x480 프레임에서 (100,100)에서 (540,380)) 정의.
- **경고 시스템**: 콘솔 출력 및 화면 메시지 표시.
- **성능**: 프레임당 처리 시간 100ms 이내 목표.
- **프라이버시**: 영상 저장 최소화, 개인정보 보호 준수.

## 전체 아키텍처

| **모듈**                | **설명**                                                                 |
|-------------------------|-------------------------------------------------------------------------|
| 비디오 캡처 모듈        | OpenCV로 웹캠에서 실시간 영상 스트림 획득.                              |
| 시선 추적 모듈          | GazeTracking으로 얼굴과 눈 감지, 시선 방향(왼쪽, 오른쪽, 중앙) 추정.   |
| 객체 탐지 모듈          | YOLOv8으로 휴대폰, 책 등 부정행위 관련 객체 탐지.                      |
| 머리 방향 추정 모듈      | Dlib로 얼굴 랜드마크 탐지, OpenCV로 머리 방향(요, 피치, 롤) 추정.      |
| 화면 영역 정의 모듈      | 화면 중앙 ROI 정의, 시선과 머리 방향이 ROI 내에 있는지 확인.           |
| 부정행위 판단 모듈      | 시선, 객체, 머리 방향, ROI 기준으로 부정행위 판단.                      |
| 경고/로그 모듈          | 부정행위 감지 시 콘솔 출력, 화면 메시지 표시, (선택적) 로그 기록.      |

## 프로세스

1. **웹캠 초기화**: OpenCV로 웹캠 열기, GazeTracking, YOLOv8, Dlib 객체 초기화.
2. **프레임 처리**:
   - GazeTracking으로 시선 방향 분석.
   - YOLOv8으로 객체 탐지 수행.
   - Dlib로 얼굴 랜드마크 탐지 및 머리 방향 추정.
   - 화면 중앙 ROI 정의 및 시선/머리 방향 확인.
3. **부정행위 탐지**:
   - 시선이 중앙이면 카운터 리셋, 비중앙이면 카운터 증가.
   - YOLOv8이 휴대폰, 책 등 탐지 시 경고.
   - 머리 방향(요 각도 ±30도 초과) 벗어나면 경고.
   - 시선 또는 머리 방향이 ROI 밖에 있으면 경고.
4. **경고 생성**:
   - 콘솔에 "부정행위 가능성 감지!" 출력.
   - 화면에 경고 메시지 표시.
   - (선택적) 로그 파일에 기록.
5. **종료**: 'q' 키 입력 시 프로그램 종료.

## 제한사항
- **정확도**: 조명, 웹캠 품질, 얼굴 각도에 따라 성능 달라짐.
- **실시간 처리**: 저사양 장치에서 프레임 드롭 가능성.
- **단순화**: 시선, 머리 방향, ROI 기준이 단순화되어 실제 시험 환경에서는 추가 조정 필요.
- **YOLOv8 성능**: 사전 학습된 모델 사용 시 특정 객체 탐지 정확도가 낮을 수 있음.

## 설치 및 실행 가이드
# 웹캠 기반 부정행위 탐지 시스템 설치 및 실행 가이드

## 1. GazeTracking 설치

GitHub에서 GazeTracking 저장소를 클론합니다:

```bash
git clone https://github.com/antoinelame/GazeTracking.git
```

## 2. 필요한 라이브러리 설치

```bash
# 기본 라이브러리
pip install opencv-python numpy dlib scipy

# YOLO 객체 탐지 (선택사항)
pip install ultralytics
```

## 3. 얼굴 랜드마크 모델 확인

GazeTracking 저장소에는 이미 얼굴 랜드마크 모델이 포함되어 있어야 합니다. 경로를 확인해보세요:

```
GazeTracking/trained_models/shape_predictor_68_face_landmarks.dat
```

파일이 없는 경우, [dlib 랜드마크 모델](http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2)을 다운로드하고 압축을 풀어 위 경로에 넣어주세요.

## 4. 코드 실행

제공된 코드를 `cheating_detector.py`와 같은 파일명으로 저장하고 실행합니다:

```bash
python cheating_detector.py
```

## 5. 선택적 기능

- **YOLOv8**: 객체 탐지를 위해 필요합니다. 첫 실행 시 자동으로 모델이 다운로드됩니다.
- **머리 방향 추정**: 얼굴 랜드마크 모델이 정상적으로 로드되면 사용 가능합니다.

코드는 필요한 구성 요소가 없어도 작동하도록 설계되었으며, 사용할 수 없는 기능은 자동으로 비활성화됩니다.

## 6. 문제 해결

### GazeTracking 관련 오류
- 코드 시작 부분의 `gaze_tracking_path` 변수를 GazeTracking 저장소의 정확한 경로로 수정하세요.
- GazeTracking 저장소의 `__init__.py` 파일이 존재하는지 확인하세요.

### 얼굴 랜드마크 모델 관련 오류
- 랜드마크 모델 파일의 경로가 정확한지 확인하세요.
- 필요한 경우 코드에서 `landmark_path` 변수를 직접 수정할 수 있습니다.

### 웹캠 접근 오류
- 다른 프로그램이 웹캠을 사용 중인지 확인하세요.
- 웹캠 장치 번호를 변경해보세요 (기본값은 0).

### YOLO 관련 오류
- YOLO 기능이 필요하지 않다면, 코드가 자동으로 이 기능을 비활성화합니다.
- 인터넷 연결을 확인하세요 (첫 실행 시 모델 다운로드 필요).
